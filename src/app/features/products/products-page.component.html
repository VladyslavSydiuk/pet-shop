<div class="marketplace-layout">
  <header class="app-header">
    <div class="container">
      <div class="header-top">
        <h1>Marketplace</h1>

      <div class="search-container">
        <mat-form-field class="search-field" appearance="fill">
          <mat-label>Пошук товару</mat-label>
          <input matInput [(ngModel)]="searchValue" (ngModelChange)="updateSearchQuery($event)" placeholder="Введіть назву">
        </mat-form-field>
      </div>
      <div class="header-actions">
        <div class="user-info" *ngIf="username || email" style="margin-right: 12px; text-align: right;">
          <div class="mat-body-2">{{ username || 'User' }}</div>
          <div class="mat-caption" *ngIf="email">{{ email }}</div>
        </div>
        <button mat-stroked-button color="warn" (click)="logout()">Logout</button>
      </div>
    </div>
    </div>
  </header>

  <div class="content">
    <!-- Лівий вертикальний дашборд -->
    <aside class="category-sidebar">
      <button
        mat-button
        [class.active]="selectedCategory() === null"
        (click)="onCategoryChange(null)"
      >
        Усі
      </button>

      <button
        mat-button
        *ngFor="let category of categories()"
        [class.active]="selectedCategory() === category"
        (click)="onCategoryChange(category)"
      >
        {{ category }}
      </button>
    </aside>

    <!-- Список товарів -->
    <main class="product-area">
      <ul class="product-list">
        <li *ngFor="let product of filteredProducts()">
          <div class="product-card" @fadeIn>
            <h3 class="product-title">{{ product.productName }}</h3>
            <img
              class="product-image"
              [src]="toImageUrl(product.avatarUrl)"
              [alt]="product.productName"
              loading="lazy"
              (error)="onImgError($event)"
            />
            <div class="product-info">
              <span class="price">{{ product.price }} грн</span>
              <ng-container *ngIf="getRatingSummary(product.id) | async as rs">
                <app-star-rating [value]="rs.avg" [readonly]="true"></app-star-rating>
                <span class="rating-count">({{ rs.count }})</span>
              </ng-container>
            </div>
            <div class="actions">
              <button mat-raised-button color="primary">Купити</button>
              <button mat-stroked-button color="accent" [routerLink]="['/product', product.id]">Деталі</button>
            </div>
          </div>
        </li>
      </ul>

      <!-- Pagination Controls -->
      <div class="pagination-container">
        <mat-paginator
          [length]="totalItems()"
          [pageSize]="pageSize()"
          [pageIndex]="pageIndex()"
          [pageSizeOptions]="[5, 10, 20, 50]"
          (page)="handlePageEvent($event)"
          aria-label="Select page">
        </mat-paginator>
      </div>
    </main>
  </div>
</div>
